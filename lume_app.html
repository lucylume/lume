<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vidiox — TikTok Creator Pro (Nuit & Bento)</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
:root{
  /* Ultra Dark Style */
  --navy-1: #030303;      
  --navy-2: #000000;      
  --bg-start: linear-gradient(135deg, #000000 0%, #050505 25%, #020202 75%, #040404 100%);
  --glass: rgba(255,255,255,0.02);
  --muted: rgba(180,180,180,0.9);
  --muted-2: rgba(160,160,160,0.8);
  --accent-silver: rgba(140,140,140,0.1);
  --accent-strong: #d0d0d0;
  --silver-grad: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 20%, #1a1a1a 40%, #303030 60%, #252525 80%, #353535 100%);
  --dark-glass: rgba(255,255,255,0.01);
  --radius: 24px;
  --max-width: 1200px;
  
  /* Auth & Profile Colors - More subtle */
  --accent-primary: #666666;
  --accent-hover: #777777;
  --border-primary: rgba(255,255,255,0.04);
  --border-secondary: rgba(255,255,255,0.06);
  --success: #444444;
  --error: #666666;
  --warning: #555555;
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', Inter, system-ui, sans-serif;
  -webkit-font-smoothing:antialiased;
  background: var(--bg-start);
  background-attachment: fixed;
  color:var(--muted);
  overflow:auto;
  position: relative;
  padding-top: 80px;
}

/* Dynamic Background Animation */
.dynamic-bg {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 1;
  overflow: hidden;
}

.bg-shape {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255,255,255,0.02) 0%, transparent 70%);
  backdrop-filter: blur(1px);
  animation: floatShape linear infinite;
}

.bg-shape:nth-child(1) {
  width: 300px;
  height: 300px;
  top: 10%;
  left: -150px;
  animation-duration: 20s;
  animation-delay: 0s;
}

.bg-shape:nth-child(2) {
  width: 200px;
  height: 200px;
  top: 60%;
  right: -100px;
  animation-duration: 25s;
  animation-delay: -5s;
}

.bg-shape:nth-child(3) {
  width: 400px;
  height: 400px;
  top: 80%;
  left: 20%;
  animation-duration: 30s;
  animation-delay: -10s;
}

.bg-shape:nth-child(4) {
  width: 150px;
  height: 150px;
  top: 20%;
  right: 30%;
  animation-duration: 18s;
  animation-delay: -8s;
}

@keyframes floatShape {
  0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { transform: translateY(-200px) rotate(360deg); opacity: 0; }
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: 
    radial-gradient(800px circle at 20% 30%, rgba(100,100,100,0.02) 0%, transparent 50%),
    radial-gradient(1000px circle at 80% 20%, rgba(80,80,120,0.015) 0%, transparent 50%),
    radial-gradient(600px circle at 40% 70%, rgba(60,60,60,0.01) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

/* star canvas sits behind UI */
#star-canvas{ position:fixed; inset:0; z-index:0; pointer-events:none; }

/* soft ambient */
.ambient{
  position:fixed; inset:0; z-index:0; pointer-events:none;
  background:
    radial-gradient(700px 320px at 12% 12%, rgba(230,235,245,0.02), transparent 18%),
    radial-gradient(600px 260px at 88% 8%, rgba(200,210,220,0.01), transparent 18%);
  mix-blend-mode:screen;
}

/* Header Navigation */
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  background: rgba(0,0,0,0.98);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border-primary);
}

.nav-container {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 24px;
}

.logo {
  font-size: 24px;
  font-weight: 700;
  color: var(--accent-strong);
  text-decoration: none;
}

.nav-menu {
  display: flex;
  align-items: center;
  gap: 32px;
  list-style: none;
}

.nav-link {
  color: var(--muted-2);
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s ease;
  font-size: 15px;
}

.nav-link:hover {
  color: var(--accent-strong);
}

.nav-actions {
  display: flex;
  align-items: center;
  gap: 16px;
}

/* User Dropdown */
.user-dropdown {
  position: relative;
}

.user-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--glass);
  border: 1px solid var(--border-primary);
  cursor: pointer;
  overflow: hidden;
  transition: all 0.2s ease;
}

.user-avatar:hover {
  border-color: var(--accent-primary);
}

.user-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.auth-btn {
  background: var(--accent-primary);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.auth-btn:hover {
  background: var(--accent-hover);
}

/* User Dropdown Menu */
.user-dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  background: rgba(5,5,5,0.95);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border-primary);
  border-radius: 12px;
  padding: 8px;
  min-width: 200px;
  opacity: 0;
  transform: translateY(-10px);
  transition: all 0.2s ease;
  pointer-events: none;
  z-index: 1000;
}

.user-dropdown-menu.show {
  opacity: 1;
  transform: translateY(0);
  pointer-events: all;
}

.dropdown-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border-radius: 8px;
  color: var(--muted);
  text-decoration: none;
  transition: all 0.2s ease;
  cursor: pointer;
  border: none;
  background: none;
  width: 100%;
  text-align: left;
  font-family: inherit;
}

.dropdown-item:hover {
  background: var(--glass);
  color: var(--accent-strong);
}

.dropdown-divider {
  height: 1px;
  background: var(--border-primary);
  margin: 8px 0;
}

/* Profile Modal */
.profile-modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.92);
  backdrop-filter: blur(20px);
  z-index: 2000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s ease;
}

.profile-modal.show {
  opacity: 1;
  pointer-events: all;
}

.profile-content {
  background: var(--bg-start);
  border: 1px solid var(--border-primary);
  border-radius: 24px;
  padding: 32px;
  max-width: 500px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  transform: scale(0.95);
  transition: all 0.3s ease;
}

.profile-modal.show .profile-content {
  transform: scale(1);
}

.profile-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 32px;
}

.profile-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 2px solid var(--border-primary);
  overflow: hidden;
}

.profile-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.profile-info h2 {
  color: var(--accent-strong);
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 4px;
}

.profile-info p {
  color: var(--muted-2);
  font-size: 14px;
}

.profile-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 16px;
  margin-bottom: 32px;
}

.stat-card {
  background: var(--glass);
  border: 1px solid var(--border-primary);
  border-radius: 16px;
  padding: 20px;
  text-align: center;
}

.stat-number {
  font-size: 28px;
  font-weight: 700;
  color: var(--accent-strong);
  margin-bottom: 4px;
}

.stat-label {
  font-size: 12px;
  color: var(--muted-2);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.profile-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

.btn-secondary {
  background: var(--glass);
  color: var(--muted);
  border: 1px solid var(--border-primary);
  padding: 10px 20px;
  border-radius: 10px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-secondary:hover {
  background: var(--border-primary);
  color: var(--accent-strong);
}

.btn-danger {
  background: rgba(239, 68, 68, 0.2);
  color: var(--error);
  border: 1px solid rgba(239, 68, 68, 0.3);
  padding: 10px 20px;
  border-radius: 10px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-danger:hover {
  background: rgba(239, 68, 68, 0.3);
}

/* Loading Modal */
.loading-modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  backdrop-filter: blur(25px);
  z-index: 3000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.4s ease;
}

.loading-modal.show {
  opacity: 1;
  pointer-events: all;
}

.loading-content {
  background: var(--bg-start);
  border: 1px solid var(--border-primary);
  border-radius: 32px;
  padding: 48px 40px;
  max-width: 600px;
  width: 100%;
  text-align: center;
  transform: scale(0.9);
  transition: all 0.4s ease;
  position: relative;
  overflow: hidden;
}

.loading-modal.show .loading-content {
  transform: scale(1);
}

.loading-content::before {
  content: '';
  position: absolute;
  inset: 0;
  background: 
    radial-gradient(600px circle at 30% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
    radial-gradient(800px circle at 70% 80%, rgba(168, 85, 247, 0.04) 0%, transparent 50%);
  pointer-events: none;
}

.loading-header {
  margin-bottom: 40px;
  position: relative;
  z-index: 1;
}

.loading-title {
  font-size: 32px;
  font-weight: 800;
  color: var(--accent-strong);
  margin-bottom: 8px;
  background: linear-gradient(135deg, var(--accent-strong) 0%, rgba(59, 130, 246, 0.8) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.loading-subtitle {
  font-size: 16px;
  color: var(--muted-2);
  font-weight: 500;
}

/* YouTube Preview */
.youtube-preview {
  display: flex;
  gap: 16px;
  align-items: center;
  background: rgba(255,255,255,0.02);
  border: 1px solid var(--border-primary);
  border-radius: 16px;
  padding: 16px;
  margin: 24px 0;
  backdrop-filter: blur(10px);
}

.preview-thumbnail {
  position: relative;
  width: 120px;
  height: 68px;
  border-radius: 8px;
  overflow: hidden;
  flex-shrink: 0;
}

.preview-thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.preview-duration {
  position: absolute;
  bottom: 4px;
  right: 4px;
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
}

.preview-info {
  flex: 1;
  text-align: left;
}

.preview-info h3 {
  font-size: 16px;
  font-weight: 600;
  color: var(--accent-strong);
  margin: 0 0 4px 0;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.preview-info p {
  font-size: 14px;
  color: var(--muted-2);
  margin: 0;
}

/* Video Preview Result */
.result-success {
  text-align: center;
  padding: 32px;
  background: var(--glass);
  border: 1px solid var(--border-primary);
  border-radius: 24px;
  backdrop-filter: blur(20px);
  margin-top: 20px;
}

.result-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--accent-strong);
  margin: 0 0 8px 0;
}

.result-subtitle {
  font-size: 18px;
  color: var(--muted);
  margin: 0 0 8px 0;
  font-weight: 500;
}

.result-info {
  font-size: 14px;
  color: var(--muted-2);
  margin: 0 0 24px 0;
}

.video-preview-container {
  position: relative;
  display: inline-block;
  border-radius: 16px;
  overflow: hidden;
  margin-bottom: 24px;
  background: #000;
  max-width: 300px;
  width: 100%;
}

.video-preview {
  width: 100%;
  height: auto;
  aspect-ratio: 9/16;
  display: block;
  border: none;
  background: #000;
}

.video-overlay {
  position: absolute;
  top: 12px;
  right: 12px;
  pointer-events: none;
}

.video-info {
  display: flex;
  gap: 8px;
}

.video-format,
.video-duration {
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
}

.result-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
  align-items: center;
}

.btn-preview,
.btn-download {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  border-radius: 12px;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.2s ease;
  cursor: pointer;
  border: none;
  font-size: 14px;
}

.btn-preview {
  background: rgba(59, 130, 246, 0.1);
  color: var(--accent-strong);
  border: 1px solid var(--accent-primary);
}

.btn-preview:hover {
  background: rgba(59, 130, 246, 0.2);
  transform: translateY(-1px);
}

.btn-download {
  background: var(--accent-strong);
  color: white;
}

.btn-download:hover {
  background: var(--accent-primary);
  transform: translateY(-1px);
}

.loading-progress {
  position: relative;
  z-index: 1;
  margin-bottom: 40px;
}

.progress-steps {
  display: flex;
  justify-content: space-between;
  margin-bottom: 24px;
  position: relative;
}

.progress-steps::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--border-primary);
  transform: translateY(-50%);
  z-index: 0;
}

.progress-line {
  position: absolute;
  top: 50%;
  left: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--accent-primary), rgba(59, 130, 246, 0.6));
  transform: translateY(-50%);
  transition: width 1s ease;
  z-index: 1;
  width: 0%;
}

.step {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  z-index: 2;
  flex: 1;
  min-width: 0;
}

.step-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--glass);
  border: 2px solid var(--border-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 12px;
  transition: all 0.6s ease;
  position: relative;
}

.step.active .step-icon {
  background: var(--accent-primary);
  border-color: var(--accent-primary);
}

.step.completed .step-icon {
  background: var(--success);
  border-color: var(--success);
}

.step-icon svg {
  width: 20px;
  height: 20px;
  color: var(--muted);
  transition: color 0.3s ease;
}

.step.active .step-icon svg,
.step.completed .step-icon svg {
  color: white;
}

.step-label {
  font-size: 13px;
  font-weight: 600;
  color: var(--muted-2);
  text-align: center;
  transition: color 0.3s ease;
  line-height: 1.3;
}

.step.active .step-label {
  color: var(--accent-primary);
}

.step.completed .step-label {
  color: var(--success);
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--glass);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 16px;
  border: 1px solid var(--border-primary);
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-primary), rgba(59, 130, 246, 0.8));
  border-radius: 4px;
  transition: width 0.5s ease;
  width: 0%;
  position: relative;
}

.progress-fill::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  animation: shimmer 2s infinite;
}

.progress-text {
  font-size: 14px;
  color: var(--muted);
  font-weight: 500;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.progress-percent {
  color: var(--accent-primary);
  font-weight: 700;
}

.loading-spinner {
  position: relative;
  z-index: 1;
  margin: 0 auto 24px;
  width: 80px;
  height: 80px;
}

.spinner {
  width: 100%;
  height: 100%;
  border: 3px solid var(--glass);
  border-top: 3px solid var(--accent-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.loading-details {
  position: relative;
  z-index: 1;
  background: var(--glass);
  border: 1px solid var(--border-primary);
  border-radius: 16px;
  padding: 20px;
  margin-top: 24px;
}

.detail-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid var(--border-primary);
}

.detail-item:last-child {
  border-bottom: none;
}

.detail-label {
  color: var(--muted-2);
  font-size: 14px;
}

.detail-value {
  color: var(--accent-strong);
  font-weight: 600;
  font-size: 14px;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* app container */
.container{
  width:100%;
  max-width:var(--max-width);
  z-index:2;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:40px;
  position: relative;
  margin: 0 auto;
  min-height: calc(100vh - 80px);
}

/* Particle System */
.particles {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 1;
  overflow: hidden;
}

.particle {
  position: absolute;
  width: 2px;
  height: 2px;
  background: rgba(255,255,255,0.4);
  border-radius: 50%;
  animation: particleFloat linear infinite;
}

.particle:nth-child(odd) {
  background: rgba(200,220,255,0.3);
  animation-duration: 8s;
}

.particle:nth-child(even) {
  background: rgba(255,200,220,0.25);
  animation-duration: 12s;
}

@keyframes particleFloat {
  0% { 
    transform: translateY(100vh) translateX(0px) scale(0); 
    opacity: 0;
  }
  10% { 
    opacity: 1;
    transform: translateY(90vh) translateX(10px) scale(1);
  }
  90% { 
    opacity: 1;
    transform: translateY(10vh) translateX(-10px) scale(1);
  }
  100% { 
    transform: translateY(0vh) translateX(0px) scale(0); 
    opacity: 0;
  }
}

/* Dark Apple Vision Pro Glass Frame */
.frame{
  width:100%;
  background: linear-gradient(135deg, 
    rgba(255,255,255,0.06) 0%,
    rgba(255,255,255,0.03) 25%,
    rgba(255,255,255,0.01) 50%,
    rgba(255,255,255,0.03) 75%,
    rgba(255,255,255,0.05) 100%);
  backdrop-filter: blur(50px) saturate(120%) brightness(1.1);
  -webkit-backdrop-filter: blur(50px) saturate(120%) brightness(1.1);
  border-radius: calc(var(--radius) + 6px);
  border: 1px solid;
  border-image: linear-gradient(135deg, 
    rgba(255,255,255,0.15) 0%,
    rgba(255,255,255,0.05) 25%,
    rgba(255,255,255,0.02) 50%,
    rgba(255,255,255,0.05) 75%,
    rgba(255,255,255,0.12) 100%) 1;
  padding:40px;
  box-shadow: 
    0 40px 160px rgba(0,0,0,0.8),
    0 16px 48px rgba(0,0,0,0.6),
    inset 0 1px 0 rgba(255,255,255,0.08),
    inset 0 -1px 0 rgba(255,255,255,0.02);
  display:grid;
  grid-template-columns: 1fr 420px;
  gap:32px;
  align-items:start;
  position: relative;
  z-index: 2;
  animation: frameFloat 12s ease-in-out infinite;
}

.frame::before {
  content: '';
  position: absolute;
  inset: -2px;
  background: var(--silver-grad);
  border-radius: calc(var(--radius) + 8px);
  opacity: 0.3;
  z-index: -1;
  animation: silverShimmer 8s ease-in-out infinite;
}

@keyframes silverShimmer {
  0%, 100% { opacity: 0.2; filter: brightness(1); }
  50% { opacity: 0.4; filter: brightness(1.2); }
}

@keyframes frameFloat {
  0%, 100% { transform: translateY(0px) scale(1) rotateX(0deg); }
  33% { transform: translateY(-8px) scale(1.001) rotateX(0.5deg); }
  66% { transform: translateY(-4px) scale(1.002) rotateX(-0.3deg); }
}

/* HERO area spanning columns */
.hero {
  grid-column: 1 / -1;
  display:flex;
  gap:28px;
  align-items:center;
  justify-content:space-between;
  padding-bottom:6px;
}

/* brand */
.brand{
  display:flex;
  gap:20px;
  align-items:center;
}
.brand-star {
  width: 120px;
  height: 120px;
  display: grid;
  place-items: center;
  font-size: 72px;
  color: #fff;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  border-radius: 50%;
  backdrop-filter: blur(10px);
  text-shadow: 
    0 0 20px rgba(255,255,255,0.8),
    0 0 40px rgba(200,200,255,0.6),
    0 0 60px rgba(150,150,255,0.4);
  transform-origin: center;
  animation: starSpinCartoon 4s ease-in-out infinite, starGlow 3s ease-in-out infinite, starFloat 6s ease-in-out infinite;
  position: relative;
  overflow: hidden;
}

.brand-star::before {
  content: '';
  position: absolute;
  inset: -10px;
  background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.1), transparent, rgba(200,220,255,0.1), transparent);
  border-radius: 50%;
  animation: starRingRotate 3s linear infinite;
  z-index: -1;
}

@keyframes starSpinCartoon {
  0% { transform: rotate(0deg) scale(1); }
  25% { transform: rotate(90deg) scale(1.1); }
  50% { transform: rotate(180deg) scale(1); }
  75% { transform: rotate(270deg) scale(1.05); }
  100% { transform: rotate(360deg) scale(1); }
}

@keyframes starRingRotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes starGlow {
  0%, 100% { 
    text-shadow: 
      0 0 20px rgba(255,255,255,0.8),
      0 0 40px rgba(200,200,255,0.6),
      0 0 60px rgba(150,150,255,0.4);
  }
  50% { 
    text-shadow: 
      0 0 30px rgba(255,255,255,1),
      0 0 60px rgba(200,200,255,0.8),
      0 0 90px rgba(150,150,255,0.6);
  }
}

@keyframes starFloat {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-8px); }
}


/* title — large, prominent, minimal text */
.title-wrap{ display:flex; flex-direction:column; gap:6px; }
.title{
  font-size: clamp(56px, 8.8vw, 120px);
  font-weight:300;
  line-height:0.9;
  color:transparent;
  background: linear-gradient(180deg,var(--accent-strong), rgba(210,215,225,0.95));
  -webkit-background-clip:text; background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow: 0 10px 40px rgba(0,0,0,0.6);
}
.subtitle{
  color:var(--muted-2);
  font-weight:600;
  font-size:16px;
  letter-spacing:0.02em;
  max-width:860px;
}

/* LEFT: main tile bigger & central */
.main-tile{
  background: linear-gradient(135deg, 
    rgba(255,255,255,0.05) 0%,
    rgba(255,255,255,0.025) 25%,
    rgba(255,255,255,0.01) 50%,
    rgba(255,255,255,0.025) 75%,
    rgba(255,255,255,0.04) 100%);
  backdrop-filter: blur(35px) saturate(110%) brightness(1.05);
  -webkit-backdrop-filter: blur(35px) saturate(110%) brightness(1.05);
  border-radius: var(--radius);
  border: 1px solid rgba(255,255,255,0.08);
  padding:32px;
  min-height:520px;
  display:flex;
  flex-direction:column;
  gap:20px;
  box-shadow: 
    0 32px 100px rgba(0,0,0,0.6),
    0 12px 32px rgba(0,0,0,0.4),
    inset 0 1px 0 rgba(255,255,255,0.06),
    inset 0 -1px 0 rgba(255,255,255,0.02);
  position: relative;
  overflow: hidden;
  animation: tileGlow 8s ease-in-out infinite;
}

/* Animated Background Shimmer */
.main-tile::after {
  content: '';
  position: absolute;
  inset: 0;
  background: 
    linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.03) 50%, transparent 70%),
    radial-gradient(circle at 30% 20%, rgba(100,150,255,0.01) 0%, transparent 50%),
    radial-gradient(circle at 70% 80%, rgba(150,100,255,0.01) 0%, transparent 50%);
  border-radius: var(--radius);
  animation: bgShimmer 12s ease-in-out infinite;
  pointer-events: none;
}

@keyframes bgShimmer {
  0%, 100% { 
    background: 
      linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.03) 50%, transparent 70%),
      radial-gradient(circle at 30% 20%, rgba(100,150,255,0.01) 0%, transparent 50%),
      radial-gradient(circle at 70% 80%, rgba(150,100,255,0.01) 0%, transparent 50%);
  }
  25% {
    background: 
      linear-gradient(135deg, transparent 30%, rgba(255,255,255,0.04) 50%, transparent 70%),
      radial-gradient(circle at 70% 30%, rgba(150,200,255,0.015) 0%, transparent 50%),
      radial-gradient(circle at 30% 70%, rgba(200,150,255,0.015) 0%, transparent 50%);
  }
  50% {
    background: 
      linear-gradient(225deg, transparent 30%, rgba(255,255,255,0.035) 50%, transparent 70%),
      radial-gradient(circle at 50% 50%, rgba(200,180,255,0.02) 0%, transparent 50%),
      radial-gradient(circle at 20% 40%, rgba(180,200,255,0.02) 0%, transparent 50%);
  }
  75% {
    background: 
      linear-gradient(315deg, transparent 30%, rgba(255,255,255,0.04) 50%, transparent 70%),
      radial-gradient(circle at 20% 70%, rgba(255,180,200,0.015) 0%, transparent 50%),
      radial-gradient(circle at 80% 30%, rgba(180,255,200,0.015) 0%, transparent 50%);
  }
}

.main-tile::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, 
    transparent 0%, 
    rgba(255,255,255,0.1) 50%, 
    transparent 100%);
  animation: shineSweep 6s ease-in-out infinite;
}

@keyframes shineSweep {
  0% { left: -100%; }
  50% { left: 100%; }
  100% { left: -100%; }
}

@keyframes tileGlow {
  0%, 100% { 
    box-shadow: 
      0 24px 80px rgba(0,0,0,0.4),
      0 8px 24px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }
  50% { 
    box-shadow: 
      0 32px 100px rgba(200,220,255,0.2),
      0 12px 32px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.3);
  }
}

/* input */
.input-row{ display:flex; gap:18px; align-items:center; margin-top:6px; }
.input-column{ flex:1; display:flex; flex-direction:column; gap:10px; }
.input-label{ font-size:12px; color:var(--muted-2); font-weight:800; letter-spacing:0.08em; text-transform:uppercase; }
#urlInput{
  width:100%;
  padding:20px 24px;
  border-radius:16px;
  border: 1px solid rgba(255,255,255,0.06);
  background: linear-gradient(135deg, 
    rgba(255,255,255,0.04) 0%,
    rgba(255,255,255,0.02) 50%,
    rgba(255,255,255,0.03) 100%);
  backdrop-filter: blur(25px) saturate(110%) brightness(1.02);
  -webkit-backdrop-filter: blur(25px) saturate(110%) brightness(1.02);
  color:var(--muted);
  font-size:16px;
  outline:none;
  box-shadow: 
    inset 0 1px 0 rgba(255,255,255,0.05),
    inset 0 -1px 0 rgba(255,255,255,0.02),
    0 6px 16px rgba(0,0,0,0.2);
  transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
  animation: inputGlow 5s ease-in-out infinite;
}

#urlInput:focus{
  border-color: rgba(255,255,255,0.25);
  box-shadow: 
    inset 0 1px 0 rgba(255,255,255,0.2),
    inset 0 -1px 0 rgba(255,255,255,0.08),
    0 8px 24px rgba(0,0,0,0.2),
    0 0 0 4px rgba(255,255,255,0.1);
  transform: translateY(-1px);
}

@keyframes inputGlow {
  0%, 100% { border-color: rgba(255,255,255,0.06); }
  50% { border-color: rgba(100,150,255,0.2); }
}
#urlInput::placeholder{ color: rgba(255,255,255,0.28); }
#urlInput:focus{ box-shadow: 0 24px 60px rgba(0,0,0,0.6); transform:translateY(-2px); border-color: rgba(255,255,255,0.08); }

/* centralized big convert button (prominent) */
.actions{ display:flex; gap:12px; align-items:center; justify-content:flex-end; margin-top:6px; }
.convert-wrap{ display:flex; gap:12px; align-items:center; }
#convertBtn{
  padding:18px 32px;
  border-radius:18px;
  border:none;
  cursor:pointer;
  font-weight:700;
  background: linear-gradient(135deg, #505050 0%, #707070 20%, #404040 40%, #606060 60%, #454545 80%, #555555 100%);
  color:#f0f0f0;
  letter-spacing:0.06em;
  text-transform:uppercase;
  font-size:14px;
  box-shadow: 
    0 12px 40px rgba(0,0,0,0.5),
    0 4px 12px rgba(0,0,0,0.3),
    inset 0 1px 0 rgba(255,255,255,0.2),
    inset 0 -1px 0 rgba(0,0,0,0.3);
  position:relative;
  overflow:hidden;
  transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
  animation: btnBreath 4s ease-in-out infinite;
}

#convertBtn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, 
    transparent 0%, 
    rgba(255,255,255,0.4) 50%, 
    transparent 100%);
  animation: btnShine 3s ease-in-out infinite;
}

@keyframes btnShine {
  0% { left: -100%; }
  50% { left: 100%; }
  100% { left: -100%; }
}

#convertBtn:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 
    0 20px 60px rgba(0,0,0,0.4),
    0 8px 20px rgba(0,0,0,0.3),
    inset 0 1px 0 rgba(255,255,255,0.8);
}

@keyframes btnBreath {
  0%, 100% { 
    transform: scale(1);
    box-shadow: 
      0 12px 40px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.6);
  }
  50% { 
    transform: scale(1.005);
    box-shadow: 
      0 16px 50px rgba(200,220,255,0.2),
      inset 0 1px 0 rgba(255,255,255,0.8);
  }
}
#convertBtn::before{ content:""; position:absolute; left:-160%; top:-40%; width:280%; height:180%; background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,0.24) 36%, rgba(255,255,255,0.08) 56%, transparent 100%); transform:rotate(-16deg); filter:blur(10px); animation:btnshine 3.6s linear infinite; }
@keyframes btnshine{0%{left:-160%}50%{left:0}100%{left:160%}} 
#convertBtn:active{ transform:translateY(1px); }

/* small tiles row simplified (less text) */
.tile-row{ display:flex; gap:14px; margin-top:8px; flex-wrap:wrap; }
.small-card{
  flex:1;
  min-width:220px;
  background: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.004));
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.02);
  padding:12px;
  box-shadow: 0 22px 70px rgba(0,0,0,0.64);
  font-weight:700;
  color:var(--muted-2);
}

/* result area (large vertical preview) */
.result{
  display:none;
  margin-top:12px;
  border-radius:14px;
  padding:14px;
  border:1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  box-shadow: 0 34px 110px rgba(0,0,0,0.7);
}
.result-title{ font-weight:900; color:var(--accent-strong); text-align:center; margin-bottom:12px; font-size:16px; }
.display-row{ display:flex; gap:18px; align-items:center; justify-content:center; flex-wrap:wrap; }
video{ width:320px; height:560px; border-radius:14px; object-fit:cover; background:#030304; box-shadow: 0 40px 120px rgba(0,0,0,0.7); }

/* transcription & download */
.transcription{ 
  font-size: 14px; 
  color: var(--muted-2); 
  padding: 12px; 
  border-radius: 12px; 
  background: linear-gradient(180deg, rgba(255,255,255,0.006), rgba(255,255,255,0.002)); 
  text-align: center;
}

.dl-btn{ text-align:center; font-weight:900; border-radius:12px; background:linear-gradient(135deg,var(--success-start),var(--success-end)); color:#000; padding:12px 14px; border:none; cursor:pointer; }

/* RIGHT: progress column — stepped, simplified to 3 steps */
.side{
  display:flex;
  flex-direction:column;
  gap:18px;
  align-items:stretch;
}
.progress-card{
  padding:24px;
  border-radius:20px;
  background: linear-gradient(135deg, 
    rgba(255,255,255,0.04) 0%,
    rgba(255,255,255,0.02) 50%,
    rgba(255,255,255,0.03) 100%);
  backdrop-filter: blur(30px) saturate(110%) brightness(1.02);
  -webkit-backdrop-filter: blur(30px) saturate(110%) brightness(1.02);
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 
    0 20px 80px rgba(0,0,0,0.5),
    0 6px 20px rgba(0,0,0,0.3),
    inset 0 1px 0 rgba(255,255,255,0.05),
    inset 0 -1px 0 rgba(255,255,255,0.02);
  position: relative;
  animation: cardPulse 6s ease-in-out infinite;
}

.progress-card::after {
  content: '';
  position: absolute;
  inset: 1px;
  border-radius: 19px;
  background: linear-gradient(135deg, 
    rgba(255,255,255,0.05) 0%,
    transparent 50%,
    rgba(255,255,255,0.03) 100%);
  pointer-events: none;
}

@keyframes cardPulse {
  0%, 100% { transform: scale(1); opacity: 0.95; }
  50% { transform: scale(1.01); opacity: 1; }
}
.progress-title{ font-weight:900; color:var(--muted); margin-bottom:8px; }
.steps{ display:flex; flex-direction:column; gap:12px; }
.step{ 
  display:flex; 
  gap:12px; 
  align-items:center; 
  padding:12px; 
  border-radius:12px; 
  border:1px solid rgba(255,255,255,0.04); 
  background: linear-gradient(135deg, rgba(255,255,255,0.008), rgba(255,255,255,0.002));
  backdrop-filter: blur(10px);
  transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
  animation: stepFloat 5s ease-in-out infinite;
}
.step:hover{ 
  transform: translateY(-8px) scale(1.02); 
  box-shadow: 0 20px 60px rgba(100,150,255,0.2);
  border-color: rgba(255,255,255,0.12);
}
.step.active {
  border-color: var(--accent-primary);
  background: rgba(59, 130, 246, 0.05);
}

@keyframes stepFloat {
  0%, 100% { transform: translateY(0px); }
  33% { transform: translateY(-2px); }
  66% { transform: translateY(2px); }
}

.step-icon{ width:46px; height:46px; border-radius:10px; display:grid; place-items:center; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008)); box-shadow: 0 10px 28px rgba(0,0,0,0.55); font-size:18px; }
.step-text{ font-weight:800; color:var(--muted); }
.step-status{ font-size:13px; color:rgba(255,255,255,0.62); margin-top:6px; }

/* progress bar */
.progress-bar{ height:10px; border-radius:999px; background:rgba(255,255,255,0.03); overflow:hidden; margin-top:12px; border:1px solid rgba(255,255,255,0.02); }
.progress-fill{ 
  height:100%; 
  width:0%; 
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-strong)); 
  transition: width .45s cubic-bezier(.2,.9,.2,1); 
}

/* tiny footer */
.footer{ font-size:13px; color:rgba(255,255,255,0.52); text-align:center; margin-top:8px; }

/* responsive */
@media (max-width:1100px){
  .frame{ grid-template-columns: 1fr; }
  video{ width:260px; height:460px; }
  .brand-star{ width:86px; height:86px }
  .title{ font-size:48px; }
  .main-tile{ min-height:480px; padding:22px; }
}
</style>
</head>
<body>
  <!-- Header Navigation -->
  <header class="header">
    <nav class="nav-container">
      <a href="#" class="logo">Vidiox</a>
      <ul class="nav-menu">
        <li><a href="#" class="nav-link">Créateur</a></li>
        <li><a href="#" class="nav-link" onclick="showProfile()">Profil</a></li>
      </ul>
      <div class="nav-actions">
        <div id="authSection" class="auth-section">
          <button class="auth-btn" onclick="signInWithGoogle()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Se connecter
          </button>
        </div>
        <div id="userSection" class="user-dropdown" style="display:none;">
          <div class="user-avatar" onclick="toggleUserMenu()">
            <img id="userAvatar" src="" alt="Avatar">
          </div>
          <div id="userDropdownMenu" class="user-dropdown-menu">
            <button class="dropdown-item" onclick="showProfile()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
              Mon Profil
            </button>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item" onclick="signOut()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
              </svg>
              Se déconnecter
            </button>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <!-- Profile Modal -->
  <div id="profileModal" class="profile-modal">
    <div class="profile-content">
      <div class="profile-header">
        <div class="profile-avatar">
          <img id="profileAvatar" src="" alt="Avatar">
        </div>
        <div class="profile-info">
          <h2 id="profileName">John Doe</h2>
          <p id="profileEmail">john@example.com</p>
        </div>
      </div>
      
      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-number" id="videoCount">0</div>
          <div class="stat-label">Vidéos créées</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="usageCount">0</div>
          <div class="stat-label">Utilisations</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="memberSince">0j</div>
          <div class="stat-label">Membre depuis</div>
        </div>
      </div>
      
      <div class="profile-actions">
        <button class="btn-secondary" onclick="closeProfile()">Fermer</button>
        <button class="btn-danger" onclick="confirmSignOut()">Se déconnecter</button>
      </div>
    </div>
  </div>

  <!-- Loading Modal -->
  <div id="loadingModal" class="loading-modal">
    <div class="loading-content">
      <div class="loading-header">
        <h2 class="loading-title">Création en cours</h2>
        <p class="loading-subtitle">Transformation de votre vidéo YouTube en TikTok</p>
        
        <!-- YouTube Preview -->
        <div class="youtube-preview" id="youtubePreview" style="display: none;">
          <div class="preview-thumbnail">
            <img id="previewThumbnail" src="" alt="Miniature YouTube" />
            <div class="preview-duration" id="previewDuration">30s</div>
          </div>
          <div class="preview-info">
            <h3 id="previewTitle">Chargement du titre...</h3>
            <p id="previewChannel">Chargement de la chaîne...</p>
          </div>
        </div>
      </div>
      
      <div class="loading-progress">
        <div class="progress-steps">
          <div class="progress-line" id="progressLine"></div>
          
          <div class="step" id="step1">
            <div class="step-icon">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
            </div>
            <div class="step-label">Analyse<br/>YouTube</div>
          </div>
          
          <div class="step" id="step2">
            <div class="step-icon">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
              </svg>
            </div>
            <div class="step-label">Extraction<br/>Audio</div>
          </div>
          
          <div class="step" id="step3">
            <div class="step-icon">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
              </svg>
            </div>
            <div class="step-label">Transcription<br/>IA</div>
          </div>
          
          <div class="step" id="step4">
            <div class="step-icon">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
              </svg>
            </div>
            <div class="step-label">Génération<br/>TikTok</div>
          </div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="progress-text">
          <span id="progressText">Initialisation...</span>
          <span class="progress-percent" id="progressPercent">0%</span>
        </div>
      </div>
      
      <div class="loading-spinner">
        <div class="spinner"></div>
      </div>
      
      <div class="loading-details">
        <div class="detail-item">
          <span class="detail-label">Statut</span>
          <span class="detail-value" id="statusDetail">En attente</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Temps estimé</span>
          <span class="detail-value" id="timeDetail">~2 minutes</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Étape actuelle</span>
          <span class="detail-value" id="currentStepDetail">Préparation</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Canvas + ambient -->
  <canvas id="star-canvas" aria-hidden="true"></canvas>
  <div class="ambient" aria-hidden="true"></div>
  
  <!-- Dynamic Background Shapes -->
  <div class="dynamic-bg" aria-hidden="true">
    <div class="bg-shape"></div>
    <div class="bg-shape"></div>
    <div class="bg-shape"></div>
    <div class="bg-shape"></div>
  </div>
  
  <!-- Floating Particles -->
  <div class="particles" aria-hidden="true" id="particles"></div>

  <div class="container">
    <div class="frame" role="application" aria-label="Vidiox UI">

      <!-- HERO -->
      <header class="hero" role="banner">
        <div class="brand">
          <div class="brand-star" aria-hidden="true" title="Vidiox">
           ✺
          </div>
          <div class="title-wrap">
            <div class="title" id="mainTitle">Vidiox</div>
            <div class="subtitle">Colle ton URL Youtube — Rendu de video Tiktok Ready • 30s • Vertical • Sous-titres</div>
          </div>
        </div>
      </header>

      <!-- LEFT: main tile -->
      <section class="main-tile" aria-labelledby="inputLabel" role="region">
        <div>
          <label id="inputLabel" class="input-label" for="urlInput">Coller URL</label>
          <div class="input-row">
            <div class="input-column">
              <input id="urlInput" type="url" placeholder="https://youtube.com/watch?v=..." autocomplete="off" />
            </div>
            <div style="width:280px; display:flex; align-items:center; justify-content:flex-end;">
              <div class="convert-wrap">
                <button id="convertBtn" onclick="convertVideo()">Convertir</button>
              </div>
            </div>
          </div>
        </div>

        <!-- result -->
        <div class="result" id="resultContainer" aria-live="polite">
          <div class="result-title">Prêt — Aperçu</div>
          <div class="display-row">
            <video id="resultVideo" controls playsinline></video>
            <div style="min-width:260px; display:flex; flex-direction:column; gap:12px;">
              <div class="transcription" id="transcription">—</div>
              <a id="downloadLink" style="display:none"></a>
              <button class="dl-btn" onclick="document.getElementById('downloadLink').click()">Télécharger MP4</button>
            </div>
          </div>
        </div>

        <div class="footer" style="margin-top:12px;vertical-align: text-bottom;">Made with ❤ pour les broke ass</div>
      </section>

      <!-- RIGHT: progress & tips -->
      <aside class="side" role="complementary">
        <div class="progress-card" role="region" aria-label="Progression">
          <div class="progress-title">Processus</div>

          <div id="progressContainer" style="display:none">
            <div class="steps">
              <div class="step" id="step1">
                <div class="step-icon">📥</div>
                <div>
                  <div class="step-text">Téléchargement</div>
                  <div class="step-status" id="status1">En attente</div>
                </div>
              </div>

              <div class="step" id="step2">
                <div class="step-icon">🎤</div>
                <div>
                  <div class="step-text">Transcription</div>
                  <div class="step-status" id="status2">En attente</div>
                </div>
              </div>

              <div class="step" id="step3">
                <div class="step-icon">🎬</div>
                <div>
                  <div class="step-text">Rendu</div>
                  <div class="step-status" id="status3">En attente</div>
                </div>
              </div>
            </div>

            <div style="margin-top:14px">
              <div class="progress-bar"><div id="progressFill" class="progress-fill" style="width:0%"></div></div>
              <div id="progressText" style="font-size:13px;color:rgba(255,255,255,0.62);text-align:center;margin-top:8px">Prêt...</div>
            </div>
          </div>

          <div id="progressIdle" style="margin-top:12px">
            <div style="font-weight:800;color:var(--muted-2);margin-bottom:8px">Prêt</div>
            <div style="font-size:13px;color:rgba(255,255,255,0.62)">Colle un lien et clique <strong>Convertir</strong></div>
            <div style="margin-top:12px;display:flex;gap:8px">
              <button style="flex:1;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);color:var(--muted);cursor:pointer" onclick="document.getElementById('progressContainer').style.display='block';document.getElementById('progressIdle').style.display='none';simulateProgress()"></button>
            </div>
          </div>
        </div>

      </aside>

    </div>
  </div>

<!-- JS: comportements conservés + simplification (3 étapes) -->
<script>
/* Keep IDs so backend integration works */
let currentStep = 0;
let progressInterval = null;

function updateStep(stepNumber, status) {
  for (let i = 1; i <= 3; i++) {
    const s = document.getElementById(`step${i}`);
    const st = document.getElementById(`status${i}`);
    if (s) s.classList.remove('active','completed');
    if (st) st.textContent = 'En attente';
  }
  const step = document.getElementById(`step${stepNumber}`);
  const statusEl = document.getElementById(`status${stepNumber}`);
  if (status === 'active') {
    if (step) step.classList.add('active');
    if (statusEl) statusEl.textContent = 'En cours...';
  } else if (status === 'completed') {
    if (step) step.classList.add('completed');
    if (statusEl) statusEl.textContent = 'Terminé';
  }
  for (let i = 1; i < stepNumber; i++) {
    const sPrev = document.getElementById(`step${i}`);
    const sePrev = document.getElementById(`status${i}`);
    if (sPrev) sPrev.classList.add('completed');
    if (sePrev) sePrev.textContent = 'Terminé';
  }
}

function updateProgress(pct, txt) {
  const f = document.getElementById('progressFill');
  const t = document.getElementById('progressText');
  if (f) f.style.width = pct + '%';
  if (t) t.textContent = txt;
}

function simulateProgress() {
  const container = document.getElementById('progressContainer');
  if (container) container.style.display = 'block';
  const idle = document.getElementById('progressIdle');
  if (idle) idle.style.display = 'none';

  const steps = [
    { step:1, duration: 2800, text: 'Téléchargement...' },
    { step:2, duration: 4200, text: 'Transcription IA...' },
    { step:3, duration: 3000, text: 'Rendu final...' }
  ];

  let idx = 0;
  let start = Date.now();
  updateStep(1,'active');
  progressInterval = setInterval(() => {
    if (idx >= steps.length) { clearInterval(progressInterval); return; }
    const s = steps[idx];
    const elapsed = Date.now() - start;
    const prog = Math.min(1, elapsed / s.duration);
    const base = (idx / steps.length) * 100;
    const contrib = (prog / steps.length) * 100;
    const pct = Math.min(base + contrib, 99);
    updateProgress(Math.round(pct), s.text);
    if (prog >= 1) {
      updateStep(s.step,'completed');
      idx++;
      if (idx < steps.length) { updateStep(steps[idx].step,'active'); start = Date.now(); }
      else { clearInterval(progressInterval); updateProgress(100,'Terminé'); }
    }
  }, 120);
}

async function convertVideo() {
  const url = document.getElementById('urlInput').value.trim();
  if (!url) { 
    showToast('Veuillez entrer une URL YouTube', 'warning');
    return; 
  }
  
  // Check authentication for usage tracking
  if (!currentUser) {
    const guestUsage = parseInt(localStorage.getItem('guestUsage') || '0')
    if (guestUsage >= 1) {
      showToast('Connectez-vous pour continuer à utiliser le service', 'warning')
      signInWithGoogle()
      return
    }
    localStorage.setItem('guestUsage', '1')
  } else {
    await trackUsage(currentUser.id)
  }
  
  const btn = document.getElementById('convertBtn');
  const resultContainer = document.getElementById('resultContainer');

  if (btn){ btn.disabled = true; btn.textContent = 'Conversion en cours…'; }
  if (resultContainer) resultContainer.style.display = 'none';

  // Show beautiful loading modal
  showLoadingModal();
  
  try {
    // Start REAL conversion with beautiful loading
    await simulateConversionProcess(url);

    // Track successful generation
    if (currentUser) {
      await trackGeneration(currentUser.id, url)
    }
    
    showToast('Vidéo TikTok créée avec succès', 'success')
    
    // Close modal only after real completion
    setTimeout(() => {
      hideLoadingModal();
    }, 2000);
    
  } catch (err) {
    hideLoadingModal();
    showToast('Erreur lors de la conversion', 'error');
  } finally {
    if (btn){ btn.disabled = false; btn.textContent = 'Convertir'; }
  }
}

document.getElementById('urlInput').addEventListener('keypress', function(e){ if (e.key === 'Enter') convertVideo(); });
document.getElementById('urlInput').focus();

// Create floating particles
function createParticles() {
  const particlesContainer = document.getElementById('particles');
  if (!particlesContainer) return;
  
  // Create 20 particles
  for (let i = 0; i < 20; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 8 + 's';
    particle.style.animationDuration = (8 + Math.random() * 8) + 's';
    particlesContainer.appendChild(particle);
  }
}

// Initialize particles
setTimeout(createParticles, 1000);
</script>

<!-- Supabase Authentication -->
<script>
// Supabase Configuration - secured
const SUPABASE_URL = window.ENV?.SUPABASE_URL || 'https://rpjmwtapyjlrgfaamyry.supabase.co'
const SUPABASE_KEY = window.ENV?.SUPABASE_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwam13dGFweWpscmdmYWFteXJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MTUzMzgsImV4cCI6MjA3MzE5MTMzOH0.3tU8IFwghC0DeGAWPlZvP75NafPHRJrUBbkH4rdZ9uc'
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY)

let currentUser = null

// Initialize auth state
async function initAuth() {
  const { data: { session } } = await supabase.auth.getSession()
  if (session?.user) {
    currentUser = session.user
    updateAuthUI(true)
  }
  
  // Listen for auth changes
  supabase.auth.onAuthStateChange((event, session) => {
    currentUser = session?.user || null
    updateAuthUI(!!session?.user)
  })
}

// Update UI based on auth state
function updateAuthUI(isAuthenticated) {
  const authSection = document.getElementById('authSection')
  const userSection = document.getElementById('userSection')
  
  if (isAuthenticated && currentUser) {
    authSection.style.display = 'none'
    userSection.style.display = 'block'
    
    // Update user avatar
    const avatar = document.getElementById('userAvatar')
    avatar.src = currentUser.user_metadata?.avatar_url || `https://api.dicebear.com/7.x/initials/svg?seed=${currentUser.email}`
  } else {
    authSection.style.display = 'block'
    userSection.style.display = 'none'
  }
}

// Google Sign-In
async function signInWithGoogle() {
  try {
    const { data, error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: window.location.origin
      }
    })
    
    if (error) throw error
    
    showToast('Connexion en cours...', 'success')
  } catch (error) {
    console.error('Erreur de connexion:', error)
    showToast('Erreur de connexion', 'error')
  }
}

// Sign Out
async function signOut() {
  try {
    const { error } = await supabase.auth.signOut()
    if (error) throw error
    showToast('Déconnexion réussie', 'success')
  } catch (error) {
    console.error('Erreur de déconnexion:', error)
    showToast('Erreur de déconnexion', 'error')
  }
}

// Toggle user menu
function toggleUserMenu() {
  const dropdown = document.getElementById('userDropdownMenu')
  dropdown.classList.toggle('show')
  
  // Close dropdown when clicking outside
  setTimeout(() => {
    document.addEventListener('click', function closeDropdown(e) {
      if (!e.target.closest('.user-dropdown')) {
        dropdown.classList.remove('show')
        document.removeEventListener('click', closeDropdown)
      }
    })
  }, 10)
}

// Show profile section
async function showProfile() {
  if (!currentUser) {
    signInWithGoogle()
    return
  }
  
  // Close dropdown
  document.getElementById('userDropdownMenu').classList.remove('show')
  
  // Update profile modal with user data
  document.getElementById('profileName').textContent = currentUser.user_metadata?.full_name || currentUser.email.split('@')[0]
  document.getElementById('profileEmail').textContent = currentUser.email
  document.getElementById('profileAvatar').src = currentUser.user_metadata?.avatar_url || `https://api.dicebear.com/7.x/initials/svg?seed=${currentUser.email}`
  
  // Get user stats
  try {
    const usage = await getUserUsage(currentUser.id)
    const generationCount = await getUserGenerationCount(currentUser.id)
    
    document.getElementById('usageCount').textContent = usage
    document.getElementById('videoCount').textContent = generationCount
    
    // Calculate member since
    const memberSince = new Date(currentUser.created_at)
    const daysSince = Math.floor((Date.now() - memberSince.getTime()) / (1000 * 60 * 60 * 24))
    document.getElementById('memberSince').textContent = `${daysSince}j`
  } catch (error) {
    console.error('Error loading user stats:', error)
  }
  
  // Show modal
  document.getElementById('profileModal').classList.add('show')
}

// Close profile modal
function closeProfile() {
  document.getElementById('profileModal').classList.remove('show')
}

// Confirm sign out
function confirmSignOut() {
  if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
    signOut()
    closeProfile()
  }
}

// Get user usage count
async function getUserUsage(userId) {
  try {
    const { data, error } = await supabase
      .from('user_usage')
      .select('conversions_used')
      .eq('user_id', userId)
      .single()
    
    if (error && error.code !== 'PGRST116') throw error
    return data?.conversions_used || 0
  } catch (error) {
    console.error('Get usage error:', error)
    return 0
  }
}

// Enhanced convert function with auth check and beautiful loading
async function convertVideoWithAuth() {
  const urlInput = document.getElementById('urlInput')
  const url = urlInput.value.trim()
  
  if (!url) {
    showToast('Veuillez entrer une URL YouTube', 'warning')
    urlInput.focus()
    return
  }
  
  // Check authentication for usage tracking
  if (!currentUser) {
    const guestUsage = parseInt(localStorage.getItem('guestUsage') || '0')
    if (guestUsage >= 1) {
      showToast('Connectez-vous pour continuer à utiliser le service', 'warning')
      signInWithGoogle()
      return
    }
    localStorage.setItem('guestUsage', '1')
  } else {
    await trackUsage(currentUser.id)
  }
  
  // Show loading modal
  showLoadingModal()
  
  try {
    // Simulate the conversion process with realistic timing
    await simulateConversionProcess(url)
    
    // Track successful generation
    if (currentUser) {
      await trackGeneration(currentUser.id, url)
    }
    
    showToast('Vidéo TikTok créée avec succès', 'success')
  } catch (error) {
    console.error('Conversion error:', error)
    showToast('Erreur lors de la conversion', 'error')
  } finally {
    setTimeout(() => {
      hideLoadingModal()
    }, 1000)
  }
}

// Track user usage
async function trackUsage(userId) {
  try {
    // Get current usage count
    let currentUsage = await getUserUsage(userId)
    
    const { data, error } = await supabase
      .from('user_usage')
      .upsert({
        user_id: userId,
        conversions_used: currentUsage + 1,
        created_at: new Date().toISOString()
      }, {
        onConflict: 'user_id'
      })
      .select()
    
    if (error) throw error
  } catch (error) {
    console.error('Usage tracking error:', error)
  }
}

// Track successful generation
async function trackGeneration(userId, videoUrl) {
  try {
    const { data, error } = await supabase
      .from('generations')
      .insert([{
        user_id: userId,
        video_url: videoUrl,
        created_at: new Date().toISOString()
      }])
    
    if (error) throw error
  } catch (error) {
    console.error('Generation tracking error:', error)
  }
}

// Get user generation count
async function getUserGenerationCount(userId) {
  try {
    const { count, error } = await supabase
      .from('generations')
      .select('*', { count: 'exact', head: true })
      .eq('user_id', userId)
    
    if (error && error.code !== 'PGRST116') throw error
    return count || 0
  } catch (error) {
    console.error('Get generation count error:', error)
    return 0
  }
}

// Loading Modal Functions
let currentProgress = 0

const loadingSteps = [
  { id: 'step1', label: 'Analyse YouTube', duration: 20, messages: [
    'Connexion à YouTube...',
    'Récupération des informations vidéo...',
    'Vérification de la qualité...',
    'Sélection du segment optimal...'
  ]},
  { id: 'step2', label: 'Extraction Audio', duration: 30, messages: [
    'Téléchargement de la vidéo...',
    'Extraction de la piste audio...',
    'Optimisation de la qualité audio...',
    'Préparation pour la transcription...'
  ]},
  { id: 'step3', label: 'Transcription IA', duration: 35, messages: [
    'Initialisation de Whisper IA...',
    'Analyse vocale en français...',
    'Génération des sous-titres...',
    'Synchronisation temporelle...'
  ]},
  { id: 'step4', label: 'Génération TikTok', duration: 15, messages: [
    'Application du format TikTok...',
    'Intégration des sous-titres...',
    'Rendu final en cours...',
    'Finalisation de la vidéo...'
  ]}
]

function showLoadingModal() {
  document.getElementById('loadingModal').classList.add('show')
  currentProgress = 0
  updateProgress(0, 'Initialisation...', 'Préparation')
  
  // Reset all steps
  loadingSteps.forEach(step => {
    const stepEl = document.getElementById(step.id)
    stepEl.classList.remove('active', 'completed')
  })
  
  document.getElementById('progressLine').style.width = '0%'
}

function hideLoadingModal() {
  document.getElementById('loadingModal').classList.remove('show')
  if (progressInterval) {
    clearInterval(progressInterval)
    progressInterval = null
  }
}

function updateProgress(percent, message, status) {
  document.getElementById('progressFill').style.width = `${percent}%`
  document.getElementById('progressPercent').textContent = `${Math.round(percent)}%`
  document.getElementById('progressText').textContent = message
  document.getElementById('statusDetail').textContent = status
  document.getElementById('currentStepDetail').textContent = message
}

function updateStep(stepIndex, state) {
  const step = document.getElementById(loadingSteps[stepIndex].id)
  const allSteps = document.querySelectorAll('.step')
  
  // Remove active from all steps
  allSteps.forEach(s => s.classList.remove('active'))
  
  if (state === 'active') {
    step.classList.add('active')
    step.classList.remove('completed')
  } else if (state === 'completed') {
    step.classList.remove('active')
    step.classList.add('completed')
  }
  
  // Update progress line
  let progressLineWidth = 0
  if (state === 'completed') {
    progressLineWidth = ((stepIndex + 1) / loadingSteps.length) * 100
  } else if (state === 'active') {
    progressLineWidth = (stepIndex / loadingSteps.length) * 100
  }
  
  document.getElementById('progressLine').style.width = `${progressLineWidth}%`
}

// Load YouTube preview info
async function loadYouTubePreview(url) {
  try {
    // Extract video ID from URL
    const videoId = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/)?.[1]
    
    if (videoId) {
      // Set thumbnail
      const thumbnail = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`
      document.getElementById('previewThumbnail').src = thumbnail
      
      // Try to get video info from API (this will use the server's ytdl info)
      try {
        const response = await fetch('/api/video-info', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        })
        
        if (response.ok) {
          const info = await response.json()
          document.getElementById('previewTitle').textContent = info.title || 'Vidéo YouTube'
          document.getElementById('previewChannel').textContent = info.channel || 'Chaîne YouTube'
        } else {
          // Fallback
          document.getElementById('previewTitle').textContent = 'Vidéo YouTube'
          document.getElementById('previewChannel').textContent = 'Chargement...'
        }
      } catch (e) {
        document.getElementById('previewTitle').textContent = 'Vidéo YouTube'
        document.getElementById('previewChannel').textContent = 'Prêt pour conversion'
      }
      
      // Show preview
      document.getElementById('youtubePreview').style.display = 'flex'
    }
  } catch (error) {
    console.error('Error loading preview:', error)
  }
}

async function simulateConversionProcess(url) {
  try {
    let totalProgress = 0
    
    // Get YouTube video info first
    await loadYouTubePreview(url)
    
    // Step 1: YouTube Analysis
    updateStep(0, 'active')
    updateProgress(10, 'Connexion à YouTube...', 'En cours')
    await new Promise(resolve => setTimeout(resolve, 1000))
    updateProgress(25, 'Analyse de la vidéo...', 'En cours')
    await new Promise(resolve => setTimeout(resolve, 1500))
    updateStep(0, 'completed')
    
    // Step 2: Audio Extraction  
    updateStep(1, 'active')
    updateProgress(35, 'Téléchargement de la vidéo...', 'En cours')
    await new Promise(resolve => setTimeout(resolve, 2000))
    updateProgress(50, 'Extraction de l\'audio...', 'En cours')
    await new Promise(resolve => setTimeout(resolve, 1500))
    updateStep(1, 'completed')
    
    // Step 3: AI Transcription
    updateStep(2, 'active')
    updateProgress(60, 'Initialisation de l\'IA...', 'En cours')
    await new Promise(resolve => setTimeout(resolve, 1000))
    updateProgress(75, 'Transcription française...', 'En cours')
    
    // REAL API CALL STARTS HERE
    let result;
    try {
      const response = await fetch('/api/convert', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          url: url,
          duration: 30
        })
      })
      
      if (!response.ok) {
        const errorText = await response.text()
        throw new Error(`Erreur serveur ${response.status}: ${errorText}`)
      }
      
      result = await response.json()
      
      if (!result.success) {
        throw new Error(result.error || 'Erreur de conversion')
      }
    } catch (fetchError) {
      console.error('Fetch error:', fetchError)
      throw new Error(`Connexion serveur échouée: ${fetchError.message}`)
    }
    
    updateProgress(85, 'Synchronisation des sous-titres...', 'En cours')
    await new Promise(resolve => setTimeout(resolve, 1000))
    updateStep(2, 'completed')
    
    // Step 4: TikTok Generation
    updateStep(3, 'active')
    updateProgress(90, 'Génération TikTok finale...', 'En cours')
    await new Promise(resolve => setTimeout(resolve, 1500))
    updateProgress(100, 'Conversion terminée !', 'Terminé')
    updateStep(3, 'completed')
    
    // Show video player with download
    document.getElementById('resultContainer').innerHTML = `
      <div class="result-success">
        <h3 class="result-title">Vidéo TikTok créée avec succès !</h3>
        <p class="result-subtitle">${result.videoTitle}</p>
        <p class="result-info">
          Segment: ${result.segment} | Transcription: "${result.transcription.substring(0, 100)}..."
        </p>
        
        <div class="video-preview-container">
          <video 
            class="video-preview" 
            controls 
            muted 
            preload="metadata"
            src="${result.downloadUrl}"
          >
            Votre navigateur ne supporte pas la lecture vidéo.
          </video>
          <div class="video-overlay">
            <div class="video-info">
              <span class="video-format">TikTok 9:16</span>
              <span class="video-duration">30s</span>
            </div>
          </div>
        </div>
        
        <div class="result-actions">
          <button onclick="document.querySelector('.video-preview').play()" class="btn-preview">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
            Prévisualiser
          </button>
          <a href="${result.downloadUrl}" download class="btn-download">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
            </svg>
            Télécharger
          </a>
        </div>
      </div>
    `
    document.getElementById('resultContainer').style.display = 'block'
    
    return result
    
  } catch (error) {
    console.error('Conversion error:', error)
    updateProgress(0, `Erreur: ${error.message}`, 'Erreur')
    throw error
  }
}

// Toast notification system
function showToast(message, type = 'info') {
  const toast = document.createElement('div')
  toast.className = `toast toast-${type}`
  toast.innerHTML = `
    <div class="toast-content">
      <span>${message}</span>
    </div>
  `
  
  const style = document.createElement('style')
  style.textContent = `
    .toast {
      position: fixed;
      top: 100px;
      right: 20px;
      z-index: 1000;
      padding: 12px 20px;
      border-radius: 8px;
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-primary);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      max-width: 300px;
    }
    .toast-success { background: rgba(16, 185, 129, 0.2); color: var(--success); }
    .toast-error { background: rgba(239, 68, 68, 0.2); color: var(--error); }
    .toast-warning { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
    .toast-info { background: var(--glass); color: var(--muted); }
    .toast.show { transform: translateX(0); }
  `
  
  if (!document.querySelector('.toast-styles')) {
    style.className = 'toast-styles'
    document.head.appendChild(style)
  }
  
  document.body.appendChild(toast)
  
  setTimeout(() => toast.classList.add('show'), 10)
  setTimeout(() => {
    toast.classList.remove('show')
    setTimeout(() => document.body.removeChild(toast), 300)
  }, 3000)
}

// Close modals when clicking outside
document.addEventListener('click', function(e) {
  // Close profile modal when clicking outside
  if (e.target.id === 'profileModal') {
    closeProfile()
  }
  // Note: Loading modal shouldn't be closed by clicking outside during conversion
})

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', initAuth)
</script>

<!-- Starfield canvas: deep navy -> black; big stars + dust + occasional comet (cozy, premium) -->
<script>
(function(){
  const canvas = document.getElementById('star-canvas');
  if(!canvas) return;
  const ctx = canvas.getContext('2d', { alpha: true });
  let W, H, dpr = Math.max(1, window.devicePixelRatio || 1);
  let stars = [], sparks = [];
  const BIG_COUNT = 26;   // a few big stars
  const MID_COUNT = 90;   // mid dust
  const SMALL_COUNT = 380; // tiny background specks
  let time = 0;

  function resize(){
    dpr = Math.max(1, window.devicePixelRatio || 1);
    canvas.width = innerWidth * dpr;
    canvas.height = innerHeight * dpr;
    canvas.style.width = innerWidth + 'px';
    canvas.style.height = innerHeight + 'px';
    ctx.setTransform(dpr,0,0,dpr,0,0);
    W = innerWidth; H = innerHeight;
    init();
  }
  window.addEventListener('resize', resize);
  resize();

  function rand(a,b){ return a + Math.random()*(b-a); }

  function init(){
    stars = [];
    // big gentle stars with halo
    for(let i=0;i<BIG_COUNT;i++){
      stars.push({
        x: Math.random()*W,
        y: Math.random()*H*0.9,
        r: rand(1.6,3.6),
        alpha: rand(0.7,1),
        phase: Math.random()*Math.PI*2,
        kind: 'big'
      });
    }
    // mid dust
    for(let i=0;i<MID_COUNT;i++){
      stars.push({
        x: Math.random()*W,
        y: Math.random()*H,
        r: rand(0.6,1.6),
        alpha: rand(0.25,0.7),
        tw: Math.random()*Math.PI*2,
        kind: 'mid'
      });
    }
    // small specks
    for(let i=0;i<SMALL_COUNT;i++){
      stars.push({
        x: Math.random()*W,
        y: Math.random()*H,
        r: rand(0.3,0.9),
        alpha: rand(0.06,0.28),
        tw: Math.random()*Math.PI*2,
        kind: 'small'
      });
    }
  }

  function spawnComet(){
    sparks.push({
      x: -40,
      y: rand(20, H*0.7),
      vx: rand(4.5,8),
      vy: rand(-0.2,0.8),
      life: 140 + Math.floor(rand(0,80)),
      size: rand(1.6,3.6),
      tail: []
    });
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    // subtle cosmic gradient
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, 'rgba(0,6,20,0.85)');
    g.addColorStop(0.5, 'rgba(0,3,10,0.9)');
    g.addColorStop(1, 'rgba(0,0,0,0.98)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    time += 0.012;

    // draw stars
    for(const s of stars){
      if (s.kind === 'big') {
        // halo
        const halo = Math.max(12, s.r*8);
        const a = 0.25 * (0.6 + 0.4*Math.sin(time*0.8 + s.phase));
        ctx.beginPath();
        ctx.fillStyle = `rgba(230,235,245,${a*0.06})`;
        ctx.arc(s.x, s.y, halo, 0, Math.PI*2);
        ctx.fill();
        // core
        const coreAlpha = s.alpha * (0.6 + 0.4*Math.sin(time*1.2 + s.phase));
        ctx.beginPath();
        ctx.fillStyle = `rgba(246,248,255,${coreAlpha})`;
        ctx.arc(s.x + Math.sin(time*0.3 + s.phase)*0.6, s.y + Math.cos(time*0.24 + s.phase)*0.6, s.r, 0, Math.PI*2);
        ctx.fill();
      } else if (s.kind === 'mid') {
        const tw = (Math.sin(s.tw + time*1.1)+1)/2;
        const alpha = Math.max(0.02, s.alpha * (0.5 + tw*0.9));
        ctx.beginPath();
        ctx.fillStyle = `rgba(240,243,250,${alpha})`;
        ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        ctx.fill();
      } else {
        const tw = (Math.sin(s.tw + time*0.9)+1)/2;
        const alpha = s.alpha * (0.4 + tw*0.6);
        ctx.beginPath();
        ctx.fillStyle = `rgba(245,247,255,${alpha})`;
        ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        ctx.fill();
      }
    }

    // occasional comets
    if (Math.random() < 0.008) spawnComet();
    for (let i = sparks.length-1; i >= 0; i--) {
      const c = sparks[i];
      c.x += c.vx;
      c.y += c.vy;
      c.life--;
      // tail push
      c.tail.unshift({x:c.x, y:c.y, a:c.life});
      if (c.tail.length > 24) c.tail.pop();

      // draw tail
      for (let t = 0; t < c.tail.length; t++) {
        const p = c.tail[t];
        const alpha = Math.max(0, (p.a/ (140+80)) * (1 - t / c.tail.length));
        ctx.beginPath();
        ctx.fillStyle = `rgba(230,240,255,${alpha*0.12})`;
        ctx.arc(p.x - t*0.8, p.y + t*0.2, Math.max(0.6, c.size * (1 - t / c.tail.length) * 0.8), 0, Math.PI*2);
        ctx.fill();
      }

      // head
      ctx.beginPath();
      ctx.fillStyle = `rgba(255,255,255,0.95)`;
      ctx.arc(c.x, c.y, c.size, 0, Math.PI*2);
      ctx.fill();

      if (c.life <= 0 || c.x > W + 60 || c.y < -60 || c.y > H + 60) sparks.splice(i,1);
    }

    requestAnimationFrame(draw);
  }

  draw();

  // update on DPR change
  let lastDPR = dpr;
  setInterval(()=>{
    if (window.devicePixelRatio !== lastDPR) { lastDPR = window.devicePixelRatio; resize(); }
  }, 1200);
})();
</script>
</body>
</html>
